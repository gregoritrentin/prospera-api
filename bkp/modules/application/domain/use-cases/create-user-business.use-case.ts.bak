import { UserBusiness } from '@/modules/application/domain/entities/user-business'
import { UserBusinessRepository } from '@/modules/application/domain/repositories/user-business-repository'
import { UniqueEntityID } from '@/core/domain/entity/unique-entity-id'
import { Either, right } from '@/core/either'
import { Injectable } from '@nestjs/common'

interface CreateUserBusinessUseCaseRequest {
  businessId: string
  userId: string
  role: string
}

type CreateUserBusinessUseCaseResponse = Either<
  null,
  {
    userBusiness: UserBusiness
  }
>

@Injectable()
export class CreateUserBusinessUseCase {
  constructor(private userBusinessRepository: UserBusinessRepository) { }

  async execute({
    businessId,
    userId,
    role,

  }: CreateUserBusinessUseCaseRequest): Promise<CreateUserBusinessUseCaseResponse> {

    const userBusiness = UserBusiness.create({
      businessId: new UniqueEntityID(businessId),
      userId: new UniqueEntityID(userId),
      role,
      status: 'PENDING'
    })

    await this.userBusinessRepository.create(userBusiness)

    return right({
      userBusiness,
    })
  }
}
